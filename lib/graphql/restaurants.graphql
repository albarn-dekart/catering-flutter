fragment RestaurantSummaryFragment on Restaurant {
    id
    name
    description
    deliveryPrice
    imageUrl
    restaurantCategories {
        edges {
            node {
                id
                name
            }
        }
    }
}

fragment RestaurantDetailFragment on Restaurant {
    ...RestaurantSummaryFragment
    phoneNumber
    email
    city
    street
    zipCode
    nip
    owner {
        id
        email
    }
}

# Fragment without owner to avoid circular reference in user->restaurant->owner->restaurant chain
fragment RestaurantDetailWithoutOwnerFragment on Restaurant {
    ...RestaurantSummaryFragment
    phoneNumber
    email
    city
    street
    zipCode
    nip
}

query GetRestaurants($first: Int, $after: String, $search: String, $category: String) {
    restaurants(first: $first, after: $after, search: $search, restaurantCategories_name: $category) {
        edges {
            node {
                ...RestaurantSummaryFragment
            }
        }
        pageInfo {
            hasNextPage
            endCursor
        }
    }
}

# For restaurant owners - uses fragment without owner to avoid circular reference
query GetUserRestaurant($id: ID!) {
    user(id: $id) {
        id
        ownedRestaurant {
            ...RestaurantDetailWithoutOwnerFragment
        }
    }
}

query GetRestaurant($id: ID!) {
    restaurant(id: $id) {
        ...RestaurantDetailFragment
        couriers {
            edges {
                node {
                    id
                    email
                    roles
                }
            }
        }
    }
}

mutation CreateRestaurant($input: createRestaurantInput!) {
    createRestaurant(input: $input) {
        restaurant {
            ...RestaurantDetailFragment
        }
    }
}

mutation UpdateRestaurant($input: updateRestaurantInput!) {
    updateRestaurant(input: $input) {
        restaurant {
            ...RestaurantDetailFragment
        }
    }
}

mutation DeleteRestaurant($input: deleteRestaurantInput!) {
    deleteRestaurant(input: $input) {
        restaurant {
            id
        }
    }
}
