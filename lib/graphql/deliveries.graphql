fragment BasicDeliveryFragment on Delivery {
    id
    status
    deliveryDate
    order {
        id
        total
        status
        customer {
            id
            email
        }
        deliveryFirstName
        deliveryLastName
        deliveryPhoneNumber
        deliveryStreet
        deliveryApartment
        deliveryCity
        deliveryZipCode
    }
    driver {
        id
        email
    }
}

fragment DriverDeliveryFragment on Delivery {
    id
    status
    deliveryDate
    order {
        id
        restaurant {
            id
            name
        }
    }
    order {
        id
        total
        status
        customer {
            id
            email
        }
        deliveryFirstName
        deliveryLastName
        deliveryPhoneNumber
        deliveryStreet
        deliveryApartment
        deliveryCity
        deliveryZipCode
        orderItems {
            edges {
                node {
                    id
                    quantity
                    mealPlan {
                        id
                        name
                        calories
                        protein
                        fat
                        carbs
                        meals(first: 20) {
                            edges {
                                node {
                                    id
                                    name
                                    calories
                                    protein
                                    fat
                                    carbs
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    driver {
        id
        email
    }
}

query GetDeliveries($first: Int, $after: String, $search: String) {
    deliveries(first: $first, after: $after, search: $search) {
        edges {
            node {
                ...BasicDeliveryFragment
            }
        }
        pageInfo {
            hasNextPage
            endCursor
        }
    }
}

# For drivers - includes their deliveries
query GetUserDeliveries($id: ID!, $first: Int, $after: String, $status: [String], $search: String, $order: [DeliveryFilter_order], $deliveryDate: [DeliveryFilter_deliveryDate]) {
    user(id: $id) {
        id
        deliveries(first: $first, after: $after, status_list: $status, search: $search, order: $order, deliveryDate: $deliveryDate) {
            edges {
                node {
                    ...DriverDeliveryFragment
                }
            }
            pageInfo {
                hasNextPage
                endCursor
            }
        }
    }
}

query GetDelivery($id: ID!) {
    delivery(id: $id) {
        ...BasicDeliveryFragment
    }
}

query GetDeliveriesByRestaurant($restaurantId: String!, $first: Int, $after: String, $status: String, $order: [DeliveryFilter_order], $search: String, $deliveryDate: [DeliveryFilter_deliveryDate]) {
    deliveries(first: $first, after: $after, status: $status, search: $search, order: $order, order_restaurant: $restaurantId, deliveryDate: $deliveryDate) {
        edges {
            node {
                ...BasicDeliveryFragment
            }
        }
        pageInfo {
            hasNextPage
            endCursor
        }
    }
}

mutation UpdateDelivery($input: updateDeliveryInput!) {
    updateDelivery(input: $input) {
        delivery {
            ...DriverDeliveryFragment
        }
    }
}

mutation DeleteDelivery($input: deleteDeliveryInput!) {
    deleteDelivery(input: $input) {
        delivery {
            id
        }
    }
}
