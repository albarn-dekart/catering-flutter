fragment OrderSummary on Order {
  id
  status
  total
  customer {
    id
    email
  }
  restaurant {
    id
    name
  }
  orderItems {
    edges {
      node {
        id
        quantity
        mealPlan {
          id
          name
          price
          calories
          protein
          fat
          carbs
        }
      }
    }
  }
  deliveries(order: [{deliveryDate: "ASC"}]) {
    edges {
      node {
        id
        status
        deliveryDate
        driver {
          id
          email
        }
      }
    }
  }
}

fragment OrderDetails on Order {
  ...OrderSummary
  paymentIntentId
  deliveryFirstName
  deliveryLastName
  deliveryPhoneNumber
  deliveryStreet
  deliveryApartment
  deliveryCity
  deliveryZipCode
}

query GetOrders($first: Int, $after: String, $status: String, $search: String) {
  orders(first: $first, after: $after, status: $status, search: $search) {
    edges {
      node {
        ...OrderSummary
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}

query GetOrdersByRestaurant($restaurantId: ID!, $first: Int, $after: String, $status: String, $search: String) {
  restaurant(id: $restaurantId) {
    id
    orders(first: $first, after: $after, status: $status, search: $search) {
      edges {
        node {
          ...OrderSummary
        }
      }
      pageInfo {
        hasNextPage
        endCursor
      }
    }
  }
}

# For customers - includes their orders
query GetUserOrders($id: ID!, $first: Int, $after: String, $status: String) {
  user(id: $id) {
    id
    orders(first: $first, after: $after, status: $status) {
      edges {
        node {
          ...OrderSummary
        }
      }
      pageInfo {
        hasNextPage
        endCursor
      }
    }
  }
}

query GetOrder($id: ID!) {
  order(id: $id) {
    ...OrderDetails
  }
}

mutation CreateOrder($input: createOrderInput!) {
  createOrder(input: $input) {
    order {
      ...OrderDetails
    }
  }
}

mutation UpdateOrder($input: updateOrderInput!) {
  updateOrder(input: $input) {
    order {
      ...OrderDetails
    }
  }
}

mutation DeleteOrder($input: deleteOrderInput!) {
  deleteOrder(input: $input) {
    order {
      id
    }
  }
}
